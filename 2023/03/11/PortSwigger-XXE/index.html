<!DOCTYPE html>
<html lang=zh-CN>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:description" content="本网站是个人兴趣爱好，总结分享经验，记录生活点滴的平台，希望在以后的学习旅途中，走出自己的风景。">
    <meta property="og:type" content="website">
    <meta name="description" content="本网站是个人兴趣爱好，总结分享经验，记录生活点滴的平台，希望在以后的学习旅途中，走出自己的风景。">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        PortSwigger-XXE - n0rt6&#39;s bolg
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_28hi1hpxx24.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>

    









<meta name="generator" content="Hexo 6.3.0"></head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> Welcome To You </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>n0rt6</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li >
                <a href="/collect/">
                    <i class="iconfont icon-shoucang1"></i>
                    <span>COLLECT</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>SEARCH</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-XML-%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5%EF%BC%9F"><span class="toc-text">什么是 XML 外部实体注入？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXE%E6%BC%8F%E6%B4%9E%E6%98%AF%E5%A6%82%E4%BD%95%E4%BA%A7%E7%94%9F%E7%9A%84%EF%BC%9F"><span class="toc-text">XXE漏洞是如何产生的？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XML%E5%AE%9E%E4%BD%93"><span class="toc-text">XML实体</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFXML%EF%BC%9F"><span class="toc-text">什么是XML？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-XML-%E5%AE%9E%E4%BD%93%EF%BC%9F"><span class="toc-text">什么是 XML 实体？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%96%87%E6%A1%A3%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89%EF%BC%9F"><span class="toc-text">什么是文档类型定义？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-XML-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E4%BD%93%EF%BC%9F"><span class="toc-text">什么是 XML 自定义实体？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-XML-%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%EF%BC%9F"><span class="toc-text">什么是 XML 外部实体？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8XXE%E6%89%A7%E8%A1%8CSSRF%E6%94%BB%E5%87%BB"><span class="toc-text">利用XXE执行SSRF攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Xinclude%E6%8A%80%E6%9C%AF"><span class="toc-text">Xinclude技术</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%BF%9B%E8%A1%8C-XXE-%E6%94%BB%E5%87%BB"><span class="toc-text">通过文件上传进行 XXE 攻击</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-bg" id="search-bg"></div>
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> Welcome To You </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        PortSwigger-XXE
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2023-03-11 13:40:41</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#CTF" title="CTF">CTF</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <meta name="referrer" content="no-referrer"/>

<h2 id="什么是-XML-外部实体注入？"><a href="#什么是-XML-外部实体注入？" class="headerlink" title="什么是 XML 外部实体注入？"></a>什么是 XML 外部实体注入？</h2><p>XML 外部实体注入（也称为 XXE）是一种 Web 安全漏洞，允许攻击者干扰应用程序对 XML 数据的处理。它通常允许攻击者查看应用程序服务器文件系统上的文件，并与应用程序本身可以访问的任何后端或外部系统进行交互。</p>
<p>在某些情况下，攻击者可以利用 XXE 漏洞执行服务器端请求伪造(SSRF) 攻击，从而升级 XXE 攻击以破坏底层服务器或其他后端基础设施。</p>
<h2 id="XXE漏洞是如何产生的？"><a href="#XXE漏洞是如何产生的？" class="headerlink" title="XXE漏洞是如何产生的？"></a>XXE漏洞是如何产生的？</h2><p>一些应用程序使用 XML 格式在浏览器和服务器之间传输数据。执行此操作的应用程序实际上总是使用标准库或平台 API 来处理服务器上的 XML 数据。XXE 漏洞的出现是因为 XML 规范包含各种潜在危险的特性，而标准解析器支持这些特性，即使它们通常不被应用程序使用。<br>XML 外部实体是一种自定义 XML 实体，其定义的值是从声明它们的 DTD 外部加载的。从安全角度来看，外部实体特别有趣，因为它们允许根据文件路径或 URL 的内容定义实体。</p>
<h2 id="XML实体"><a href="#XML实体" class="headerlink" title="XML实体"></a>XML实体</h2><h3 id="什么是XML？"><a href="#什么是XML？" class="headerlink" title="什么是XML？"></a>什么是XML？</h3><p>XML 代表“可扩展标记语言”。XML 是一种设计用于存储和传输数据的语言。与 HTML 一样，XML 使用树状结构的标记和数据。与 HTML 不同，XML 不使用预定义的标签，因此可以为标签指定描述数据的名称。在网络历史的早期，XML 作为一种数据传输格式很流行（“AJAX”中的“X”代表“XML”）。但它的受欢迎程度现在已经下降，取而代之的是 JSON 格式。</p>
<h3 id="什么是-XML-实体？"><a href="#什么是-XML-实体？" class="headerlink" title="什么是 XML 实体？"></a>什么是 XML 实体？</h3><p>XML 实体是一种在 XML 文档中表示数据项的方式，而不是使用数据本身。XML 语言规范中内置了各种实体。例如，实体<code>&amp;lt;</code>和<code>&amp;gt;</code>表示字符&lt;和&gt;。这些是用于表示 XML 标记的元字符，因此当它们出现在数据中时，通常必须使用它们的实体来表示。</p>
<h3 id="什么是文档类型定义？"><a href="#什么是文档类型定义？" class="headerlink" title="什么是文档类型定义？"></a>什么是文档类型定义？</h3><p>XML 文档类型定义 (DTD) 包含可以定义 XML 文档的结构、它可以包含的数据值的类型以及其他项目的声明。DTD 在DOCTYPEXML 文档开头的可选元素中声明。DTD 可以完全独立于文档本身（称为“内部 DTD”），也可以从其他地方加载（称为“外部 DTD”），或者可以是两者的混合。</p>
<h3 id="什么是-XML-自定义实体？"><a href="#什么是-XML-自定义实体？" class="headerlink" title="什么是 XML 自定义实体？"></a>什么是 XML 自定义实体？</h3><p>XML 允许在 DTD 中定义自定义实体。例如：</p>
<blockquote>
<p><code>&lt;!DOCTYPE foo [ &lt;!ENTITY myentity &quot;my entity value&quot; &gt; ]&gt;</code><br>此定义意味着 XML 文档中对实体引用的任何使用都&amp;myentity;将替换为定义的值：“ my entity value”。</p>
</blockquote>
<h3 id="什么是-XML-外部实体？"><a href="#什么是-XML-外部实体？" class="headerlink" title="什么是 XML 外部实体？"></a>什么是 XML 外部实体？</h3><p>XML 外部实体是一种自定义实体，其定义位于声明它们的 DTD 之外。</p>
<p>外部实体的声明使用关键字SYSTEM，并且必须指定应从中加载实体值的 URL。例如：</p>
<blockquote>
<p><code>&lt;!DOCTYPE foo [ &lt;!ENTITY ext SYSTEM &quot;http://normal-website.com&quot; &gt; ]&gt;</code><br>URL 可以使用该file:&#x2F;&#x2F;协议，因此可以从文件加载外部实体。例如：</p>
</blockquote>
<blockquote>
<p><code>&lt;!DOCTYPE foo [ &lt;!ENTITY ext SYSTEM &quot;file:///path/to/file&quot; &gt; ]&gt;</code></p>
</blockquote>
<h2 id="利用XXE执行SSRF攻击"><a href="#利用XXE执行SSRF攻击" class="headerlink" title="利用XXE执行SSRF攻击"></a>利用XXE执行SSRF攻击</h2><p><img src="https://img-blog.csdnimg.cn/61f07784b7f245fd8f31186f0f1043f3.png" alt="1">进入网站在<strong>检查商店商店</strong>时，网站提交了POST请求，打开之后看到有XML<br><img src="https://img-blog.csdnimg.cn/6afd2b71181c40dca1a5c0ca2efe8f27.png" alt="1"><br>不妨构造XXE。</p>
<p><img src="https://img-blog.csdnimg.cn/3a23d819d8834ca6aee716adc370b6f6.png" alt="2"><br><img src="https://img-blog.csdnimg.cn/ea03a4027ab14aa79ec1121e48d6c6f0.png" alt="3"><br>跟着他说的依次访问，直到找到ACCESSkeyid<br><img src="https://img-blog.csdnimg.cn/9fc4a18f08df4f498ec23ab9850abc09.png" alt="5"></p>
<h2 id="Xinclude技术"><a href="#Xinclude技术" class="headerlink" title="Xinclude技术"></a>Xinclude技术</h2><p>XInclude 是一种支持将多个 XML 文档中的内容包含在单个 XML 文档中的技术。它是 XML 技术家族的一部分，旨在简化大型 XML 文档的创建和管理。</p>
<p>使用 XInclude，您可以创建一个“主”XML 文档，该文档将其他 XML 文档作为“子文档”引用。这些子文档可以按值或引用包含在内，生成的主控文档可以用作独立的 XML 文档。</p>
<p>XInclude 使用 XML 命名空间，其定义如下：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">
xmlns:xi="http://www.w3.org/2001/XInclude"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>XInclude 支持两种类型的包含：按引用包含和按值包含。当您希望将外部文档作为 URI 包含时，将使用按引用包含，而当您希望包含外部文档的实际内容时，则使用按值包含。</p>
<p>下面是一个包含外部文档的 XInclude 语句示例，该语句使用按引用包含：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xi:</span>include</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>external.xml<span class="token punctuation">"</span></span> <span class="token attr-name">parse</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>xml<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>下面是一个包含外部文档的 XInclude 语句示例，该语句使用 include-by-value：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xi:</span>include</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>external.xml<span class="token punctuation">"</span></span> <span class="token attr-name">parse</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>XInclude 可以与任何 XML 文档一起使用，并且它受到 XML 解析器和编辑器的广泛支持。它能够简化大型 XML 文档的创建和管理，使其成为开发人员和内容创建者的宝贵工具。</p>
<p>一些应用程序接收客户端提交的数据，在服务器端将其嵌入到 XML 文档中，然后解析该文档。当客户端提交的数据被放入后端 SOAP 请求，然后由后端 SOAP 服务处理时，就会出现这种情况的一个示例。</p>
<p>在这种情况下，您无法执行经典的 XXE 攻击，因为您无法控制整个 XML 文档，因此无法定义或修改元素<code>DOCTYPE</code>。但是，您也许可以改用<code>XInclude</code>。<code>XInclude</code>是 XML 规范的一部分，它允许从子文档构建 XML 文档。您可以<code>XInclude</code>在 XML 文档中的任何数据值中进行攻击，因此可以在您仅控制放置在服务器端 XML 文档中的单个数据项的情况下执行攻击。</p>
<p>要执行<code>XInclude</code>攻击，您需要引用<code>XInclude</code>命名空间并提供您希望包含的文件的路径。例如：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foo</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XInclude<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xi:</span>include</span> <span class="token attr-name">parse</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file:///etc/passwd<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foo</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h2 id="通过文件上传进行-XXE-攻击"><a href="#通过文件上传进行-XXE-攻击" class="headerlink" title="通过文件上传进行 XXE 攻击"></a>通过文件上传进行 XXE 攻击</h2><p>一些应用程序允许用户上传文件，然后在服务器端进行处理。一些常见的文件格式使用 XML 或包含 XML 子组件。基于 XML 的格式的示例是办公文档格式（如 DOCX）和图像格式（如 SVG）。</p>
<p>例如，应用程序可能允许用户上传图像，并在上传后在服务器上处理或验证这些图像。即使应用程序希望接收 PNG 或 JPEG 等格式，正在使用的图像处理库也可能支持 SVG 图像。由于 SVG 格式使用 XML，攻击者可以提交恶意 SVG 图像，从而达到 XXE 漏洞的隐藏攻击面。</p>
<p><code>&lt;?xml version=&quot;1.0&quot; standalone=&quot;yes&quot;?&gt;&lt;!DOCTYPE test [ &lt;!ENTITY xxe SYSTEM &quot;file:///etc/hostname&quot; &gt; ]&gt;&lt;svg width=&quot;128px&quot; height=&quot;128px&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; version=&quot;1.1&quot;&gt;&lt;text font-size=&quot;16&quot; x=&quot;0&quot; y=&quot;16&quot;&gt;&amp;xxe;&lt;/text&gt;&lt;/svg&gt;</code></p>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>
        <div id="lv-container"></div>
        <div class="giscus"></div>
    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.xml"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






</html>
